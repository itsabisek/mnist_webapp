{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar environment_1 = require(\"../environment\");\n\nvar globals_1 = require(\"../globals\");\n\nvar ops_1 = require(\"../ops/ops\");\n\nvar sgd_optimizer_1 = require(\"./sgd_optimizer\");\n\nvar MomentumOptimizer = function (_super) {\n  __extends(MomentumOptimizer, _super);\n\n  function MomentumOptimizer(learningRate, momentum, useNesterov) {\n    if (useNesterov === void 0) {\n      useNesterov = false;\n    }\n\n    var _this = _super.call(this, learningRate) || this;\n\n    _this.learningRate = learningRate;\n    _this.momentum = momentum;\n    _this.useNesterov = useNesterov;\n    _this.m = ops_1.scalar(_this.momentum);\n    _this.accumulations = {};\n    return _this;\n  }\n\n  MomentumOptimizer.prototype.applyGradients = function (variableGradients) {\n    var _this = this;\n\n    var _loop_1 = function _loop_1(variableName) {\n      var value = environment_1.ENV.engine.registeredVariables[variableName];\n\n      if (this_1.accumulations[variableName] == null) {\n        var trainable_1 = false;\n        globals_1.tidy(function () {\n          _this.accumulations[variableName] = ops_1.zerosLike(value).variable(trainable_1);\n        });\n      }\n\n      var accumulation = this_1.accumulations[variableName];\n      var gradient = variableGradients[variableName];\n      globals_1.tidy(function () {\n        var newValue;\n\n        var newAccumulation = _this.m.mul(accumulation).add(gradient);\n\n        if (_this.useNesterov) {\n          newValue = _this.c.mul(gradient.add(newAccumulation.mul(_this.m))).add(value);\n        } else {\n          newValue = _this.c.mul(newAccumulation).add(value);\n        }\n\n        _this.accumulations[variableName].assign(newAccumulation);\n\n        value.assign(newValue);\n      });\n    };\n\n    var this_1 = this;\n\n    for (var variableName in variableGradients) {\n      _loop_1(variableName);\n    }\n  };\n\n  MomentumOptimizer.prototype.dispose = function () {\n    _super.prototype.dispose.call(this);\n\n    this.m.dispose();\n\n    if (this.accumulations != null) {\n      for (var variableName in this.accumulations) {\n        this.accumulations[variableName].dispose();\n      }\n    }\n  };\n\n  MomentumOptimizer.prototype.setMomentum = function (momentum) {\n    this.momentum = momentum;\n  };\n\n  return MomentumOptimizer;\n}(sgd_optimizer_1.SGDOptimizer);\n\nexports.MomentumOptimizer = MomentumOptimizer;","map":null,"metadata":{},"sourceType":"script"}